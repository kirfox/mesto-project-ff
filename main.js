(()=>{"use strict";var e={d:(t,n)=>{for(var r in n)e.o(n,r)&&!e.o(t,r)&&Object.defineProperty(t,r,{enumerable:!0,get:n[r]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t)};e.d({},{o:()=>M,K:()=>D});var t={baseUrl:"https://nomoreparties.co/v1/wff-cohort-14",headers:{authorization:"b7b7957f-394b-49b0-b80c-2ff9edca68da","Content-Type":"application/json"}},n=function(e){e.classList.add("popup_is-opened"),document.addEventListener("keydown",o)};function r(e){e.classList.remove("popup_is-opened"),document.removeEventListener("keydown",o)}function o(e){"Escape"===e.key&&r(document.querySelector(".popup_is-opened"))}var c=document.querySelector("#card-template").content,u=function(e){n(D),M.setAttribute("id",e._id)},a=function(e,n,r){e.classList.toggle("card__like-button_is-active"),e.classList.contains("card__like-button_is-active")?function(e){return fetch("".concat(t.baseUrl,"/cards/likes/").concat(e._id),{method:"PUT",headers:t.headers}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}))}(n).then((function(e){return r.textContent=e.likes.length})).catch((function(e){return console.log("Ошибка: ".concat(e))})):function(e){return fetch("".concat(t.baseUrl,"/cards/likes/").concat(e._id),{method:"DELETE",headers:t.headers}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}))}(n).then((function(e){return r.textContent=e.likes.length})).catch((function(e){return console.log("Ошибка: ".concat(e))}))},i=function(e){var t=e.formSelector.querySelector(".".concat(e.submitButtonSelector));e.inputSelector.forEach((function(n){n.addEventListener("input",(function(){var r=e.formSelector.querySelector(".".concat(n.id,"-error"));n.validity.patternMismatch?n.setCustomValidity(n.dataset.errorMessage):n.setCustomValidity(""),n.validity.valid?s(e.formSelector,e):(n.classList.add(e.inputErrorClass),r.textContent=n.validationMessage,r.classList.add(e.errorClass),t.classList.add(e.inactiveButtonClass))}))}))},s=function(e,t){var n=e.querySelector(".".concat(t.submitButtonSelector));t.inputSelector.forEach((function(e){var n=t.formSelector.querySelector(".".concat(e.id,"-error"));e.validity.patternMismatch||e.setCustomValidity(""),e.validity.valid&&(e.classList.remove(t.inputErrorClass),n.classList.remove(t.errorClass),n.textContent="")})),l(t.inputSelector)?n.classList.add(t.inactiveButtonClass):n.classList.remove(t.inactiveButtonClass)},l=function(e){return e.some((function(e){return!e.validity.valid}))},p=document.querySelector(".places__list"),d=document.querySelector(".popup_type_new-card"),_=d.querySelector(".popup__input_type_card-name"),f=d.querySelector(".popup__input_type_url"),m=d.querySelector(".popup__form"),v=d.querySelector(".popup__close"),y=document.querySelector(".popup_type_edit"),S=y.querySelector(".popup__input_type_name"),h=y.querySelector(".popup__input_type_description"),b=y.querySelector(".popup__form"),q=y.querySelector(".popup__close"),k=document.querySelector(".popup_type_image"),L=k.querySelector(".popup__image"),C=k.querySelector(".popup__caption"),E=k.querySelector(".popup__close"),g=document.querySelector(".profile__title"),j=document.querySelector(".profile__description"),x=document.querySelector(".profile__image"),P=document.querySelector(".profile__edit-button"),B=document.querySelector(".profile__add-button"),U=document.querySelector(".popup_type_edit-avatar"),O=U.querySelector(".popup__input_type_link"),T=U.querySelector(".popup__form"),w=U.querySelector(".popup__close"),D=document.querySelector(".popup_type_delete"),M=D.querySelector(".popup__form"),N=D.querySelector(".popup__close");d.classList.add("popup_is-animated"),y.classList.add("popup_is-animated"),k.classList.add("popup_is-animated"),U.classList.add("popup_is-animated"),D.classList.add("popup_is-animated"),fetch("".concat(t.baseUrl,"/users/me"),{headers:t.headers}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))})).then((function(e){g.textContent=e.name,j.textContent=e.about,x.style.backgroundImage="url(".concat(e.avatar,")")})).catch((function(e){return console.log("Ошибка: ".concat(e))})),B.addEventListener("click",(function(){var e={formSelector:m,inputSelector:[_,f],submitButtonSelector:"popup__button",inactiveButtonClass:"popup__button_disabled",inputErrorClass:"popup__input_type_error",errorClass:"form__input-error_active"};s(m,e),i(e),n(d)})),P.addEventListener("click",(function(){var e={formSelector:b,inputSelector:[S,h],submitButtonSelector:"popup__button",inactiveButtonClass:"popup__button_disabled",inputErrorClass:"popup__input_type_error",errorClass:"form__input-error_active"};S.value=g.textContent,h.value=j.textContent,s(b,e),i(e),n(y)})),x.addEventListener("click",(function(){var e={formSelector:T,inputSelector:[O],submitButtonSelector:"popup__button",inactiveButtonClass:"popup__button_disabled",inputErrorClass:"popup__input_type_error",errorClass:"form__input-error_active"};s(T,e),i(e),n(U)}));var A=function(e){n(k),L.src=e.querySelector(".card__image").src,C.textContent=e.querySelector(".card__description").textContent};d.addEventListener("click",(function(e){return r(e.target)})),y.addEventListener("click",(function(e){return r(e.target)})),k.addEventListener("click",(function(e){return r(e.target)})),U.addEventListener("click",(function(e){return r(e.target)})),D.addEventListener("click",(function(e){return r(e.target)})),b.addEventListener("submit",(function(e){e.preventDefault();var n=e.target.querySelector(".popup__button");n.textContent="Сохранить...",function(e,n){return fetch("".concat(t.baseUrl,"/users/me"),{method:"PATCH",headers:t.headers,body:JSON.stringify({name:e.value,about:n.value})}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}))}(S,h).catch((function(e){return console.log("Ошибка: ".concat(e))})).finally((function(){return n.textContent="Сохранить"})),r(y)})),m.addEventListener("submit",(function(e){e.preventDefault();var n=e.target.querySelector(".popup__button");n.textContent="Сохранить...",function(e,n){return fetch("".concat(t.baseUrl,"/cards"),{method:"POST",headers:t.headers,body:JSON.stringify({name:e.value,link:n.value})}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}))}(_,f).catch((function(e){return console.log("Ошибка: ".concat(e))})).finally((function(){return n.textContent="Сохранить"})),r(d),_.value="",f.value=""})),T.addEventListener("submit",(function(e){e.preventDefault();var n=e.target.querySelector(".popup__button");n.textContent="Сохранить...",function(e){return fetch("".concat(t.baseUrl,"/users/me/avatar"),{method:"PATCH",headers:t.headers,body:JSON.stringify({avatar:e.value})}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}))}(O).catch((function(e){return console.log("Ошибка: ".concat(e))})).finally((function(){return n.textContent="Сохранить"})),r(U)})),M.addEventListener("submit",(function(e){var n;e.preventDefault(),n=e.target.id,fetch("".concat(t.baseUrl,"/cards/").concat(n),{method:"DELETE",headers:t.headers}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))})),r(D)})),E.addEventListener("click",(function(){return r(k)})),v.addEventListener("click",(function(){return r(d)})),q.addEventListener("click",(function(){return r(y)})),w.addEventListener("click",(function(){return r(U)})),N.addEventListener("click",(function(){return r(D)})),Promise.all([fetch("".concat(t.baseUrl,"/cards"),{headers:t.headers}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}))]).then((function(e){e[0].forEach((function(e){p.append(function(e,t,n,r){var o=c.querySelector(".card").cloneNode(!0),u=o.querySelector(".card__delete-button"),a=o.querySelector(".card__like-button"),i=o.querySelector(".card__image"),s=o.querySelector(".card__like-count");return"34dde54b084d6798c88ac757"!==e.owner._id&&u.remove(),e.likes.length>0&&e.likes.forEach((function(e){"34dde54b084d6798c88ac757"===e._id&&a.classList.add("card__like-button_is-active")})),o.querySelector(".card__title").textContent=e.name,i.src=e.link,s.textContent=e.likes.length,i.alt="На карточке изображено "+e.name,u.addEventListener("click",(function(){return t(e)})),a.addEventListener("click",(function(){return n(a,e,s)})),i.addEventListener("click",(function(){return r(o)})),o}(e,u,a,A))}))})).catch((function(e){return console.log("Ошибка: ".concat(e))}))})();